---
import Layout from "../layouts/Layout.astro";
import FeaturedArticles from "../components/FeaturedArticles.astro";
import type { featuredHome } from "@prisma/client";
import prisma from "../prisma";
import BannerEdition from "../components/BannerEdition.astro";
import FeaturedSection from "../components/FeaturedSection.astro";
import { getSectionsCategories } from "../components/utils/categories";

// Get featured articles ids
const featuredArticlesIds: featuredHome | null =
  await prisma.featuredHome.findFirst({
    orderBy: {
      featuredHome_timestamp: "desc",
    },
  });

const categories = await getSectionsCategories();
---

<Layout title="Welcome to Astro." active="home" style="nouse">
  <main class="px-[3%] sm:px-[0.5%] pt-8 2xl:px-[13%]">
    <div class="featured-articles">
      <FeaturedArticles
        featuredArticlesIds={featuredArticlesIds?.featuredHome_articles
          ?.split(",")
          .map(Number)}
      />
    </div>
    <BannerEdition />
    {categories.map((category) => <FeaturedSection category={category} />)}
  </main>
</Layout>
