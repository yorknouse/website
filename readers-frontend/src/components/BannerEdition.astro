---
import prisma from "../prisma";
import { fail } from "./utils/fail";
import { s3URL } from "./utils/s3URL";

const latestEdition = await prisma.editions.findFirst({
  orderBy: {
    editions_published: "desc",
  },
});

if (latestEdition === null) {
  fail("Could not fetch latest edition");
  return;
}

if (latestEdition.editions_thumbnail === null) {
  fail("Edition thumbnail is null!");
  return;
}

const thumbnail = await s3URL(latestEdition.editions_thumbnail, "medium");
---

<div class="grid h-1/3 w-full grid-rows-2 gap-4 sm:grid-cols-5 sm:grid-rows-1">
  {/* Banner */}
  <div
    class="relative flex rounded-md border-4 border-whiteish-200 sm:col-span-3"
  >
    <a href={`${import.meta.env.BASE_URL}join`} class="z-10 flex h-full w-full">
      <img
        class="mx-auto my-auto w-2/5"
        src="https://bbcdn.nouse.co.uk/file/nouseSiteAssets/headerImages/join-nouse-gif.gif"
      />
    </a>
    <div
      class="absolute h-full w-full bg-[url('https://bbcdn.nouse.co.uk/file/nouseSiteAssets/headerImages/join-nouse-gif.gif')] bg-cover blur-[6px]"
    >
    </div>
  </div>

  {/* Edition */}
  <div
    class="grid grid-cols-2 rounded-md border-4 border-whiteish-200 p-4 sm:col-span-2"
  >
    <div class="flex flex-col self-center">
      <p class="text-center uppercase md:text-2xl lg:text-4xl xl:text-5xl">
        Our<br />latest<br />edition
      </p>
      <p
        class="mt-5 text-center text-base sm:text-sm md:text-base lg:text-lg xl:text-xl"
      >
        {latestEdition?.editions_name}
      </p>
    </div>
    <a class="self-center" href={`${import.meta.env.BASE_URL}print-edition`}>
      <img class="aspect-edition" src={thumbnail} />
    </a>
  </div>
</div>
